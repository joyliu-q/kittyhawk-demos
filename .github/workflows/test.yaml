# Generated by cdkactions. Do not modify
# Generated as part of the 'application' stack.
name: Build and Deploy
on: push
jobs:
  deploy-test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - id: synth
        name: Synth cdk8s manifests
        run: |-
          # get repo name (by removing owner/organization)
          export RELEASE_NAME=\${REPOSITORY#*/}

          # Export RELEASE_NAME as an output
          echo "::set-output name=RELEASE_NAME::$RELEASE_NAME"

          # yarn build
        env:
          GIT_SHA: ${{ github.sha }}
          REPOSITORY: ${{ github.repository }}
      - name: Deployment Test
        run: |-
          # get repo name from synth step
          RELEASE_NAME=\${{ steps.synth.outputs.RELEASE_NAME }}

          # check for feature-branch deployment set-up
          if [[ \${{ github.ref }} != 'refs/heads/main' ]]; then
            export IS_FEATURE_BRANCH=true
            export PR_NUMBER=\${{ github.event.number }}
            export RELEASE_NAME=$RELEASE_NAME-pr-\${{ github.event.number }}
          fi

          # Check env variables
          echo $IS_FEATURE_BRANCH
          echo $PR_NUMBER
          echo $RELEASE_NAME
          
          # See yaml file lol
          # cat k8s/dist/pennlabs.k8s.yaml
